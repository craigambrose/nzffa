- content_for 'page_css' do
  = css_for_readers_groups @reader

- if @reader.errors.any?
  %p.haserror
    %strong
      Sorry: the reader could not be saved:
    = @reader.errors.full_messages.to_sentence

- form_for [:admin, @reader] do |f|
  %table.fieldset{:cellpadding=>0, :cellspacing=>0, :border=>0}

    - if Radiant::Config['reader.use_honorifics?']
      %tr
        %th.label
          = f.label :honorific, 'Title or rank', :class => 'optional'
        %td.field
          = f.text_field "honorific", :class => 'textbox', :maxlength => 100 
        %td.help Optional.
    %tr
      %th.label
        = f.label :first_name, "First Name", :class => 'required'
      %td.field
        = f.text_field "first_name", :class => 'textbox', :maxlength => 100 
      %td.help Required.
    %tr
      %th.label
        = f.label :last_name, "Last Name", :class => 'required'
      %td.field
        = f.text_field "last_name", :class => 'textbox', :maxlength => 100 
      %td.help Required.
    %tr
      %th.label
        = f.label :email, "E-mail", :class => 'required'
      %td.field
        = f.text_field "email", :class => 'textbox', :maxlength => 255
      %td.help
        Required and must be valid.
    %tr
      %th.label
        = f.label :login, 'Username'
      %td.field
        = f.text_field "login", :class => 'textbox', :maxlength => 40 
      %td.help
        Defaults to email address. Must be unique.
    %tr
      %th.label
        = f.label :password
      %td.field
        = f.password_field "password", :class => 'textbox', :value => '', :maxlength => 40
      %td.help{:rowspan=>2}
        At least 5 characters.
        - unless @reader.new_record?
          Leave password blank for it to remain unchanged.
    %tr
      %th.label
        = f.label :password_confirmation, "Confirm Password"
      %td.field
        = f.password_field "password_confirmation", :class => 'textbox', :value => '', :maxlength => 40
    %tr
      %th.label
        = f.label :address_1, "Address", :class => 'required'
      %td.field
        - 1.upto 4 do |n|
          = f.text_field "address_#{n}", :class => 'textbox', :maxlength => 255
      %td.help Required.
    %tr
      %th.label
        = f.label :country_code, "Country", :class => 'required'
      %td.field
        = country_select(:reader, :country_code, ["AU", "NZ"], :prompt => true, :value => @reader.country_code)
      %td.help 
        Required.
    %tr
      %th.label
        = f.label :postcode, "Post Code", :class => 'required'
      %td.field
        = f.text_field "postcode", :class => 'textbox', :maxlength => 10
      %td.help 
        Required.
  %p
    = link_to("Toggle optional fields", "#", :onclick => "Effect.toggle('optional_fields', 'blind', { duration: 0.3 });")
  #optional_fields
    %table.fieldset{:cellpadding=>0, :cellspacing=>0, :border=>0}
      %tr
        %th.label
          = f.label :billing_address_1, "Billing Address", :class => 'optional'
        %td.field
          - 1.upto 4 do |n|
            = f.text_field "billing_address_#{n}", :class => 'textbox', :maxlength => 255
        %td.help
          Optional.
      %tr
        %th.label
          = f.label :billing_country_code, "Billing Country", :class => 'optional'
        %td.field
          = country_select(:reader, :billing_country_code, ["AU", "NZ"], :prompt => true, :value => @reader.billing_country_code)
        %td.help
          Optional.
      %tr
        %th.label
          = f.label :billing_postcode, "Billing Post Code", :class => 'optional'
        %td.field
          = f.text_field "billing_postcode", :class => 'textbox', :maxlength => 10
        %td.help
          Optional.
      %tr
        %th.label
          = f.label :description, "Readers description", :class => 'optional'
        %td.field
          = f.text_area "description", :size => '40x4', :class => "textarea" 
        %td.help
          Optional.
      %tr
        %th.label
          = f.label :fax, "fax", :class => 'optional'
        %td.field
          = f.text_field "fax", :class => 'textbox', :maxlength => 40
        %td.help
          Optional.
      %tr
        %th.label
          = f.label :mobile, "mobile", :class => 'optional'
        %td.field
          = f.text_field "mobile", :class => 'textbox', :maxlength => 40
        %td.help
          Optional.
      %tr
        %th.label
          = f.label :contact_person, "Contact Person", :class => 'optional'
        %td.field
          = f.text_field "contact_person", :class => 'textbox', :maxlength => 40
        %td.help
          Optional.        
      - if false
        %tr
          %th.label
            = f.label :trusted, 'Trusted?'
          %td.field{:style=>"text-align: left;"}
            %span.checkbox
              = f.check_box "trusted"
          %td.help
            True by default. Uncheck to limit a reader's actions on the site.
      %tr
        %th.label
          = f.label :notes, "Admin notes", :class => 'optional'
        %td.field
          ~ f.text_area "notes", :size => '40x4', :class => "textarea" 
        %td.help
          Optional.
  %br
  = updated_stamp @reader  
  %p.buttons
    = save_model_button(@reader)
    = save_model_and_continue_editing_button(@reader)
    or 
    = link_to "Cancel", admin_readers_path
          
          
%br
%h2 Groups
%p#reader_groups
  = pretty_groups @reader.groups
  %br
  = link_to "Edit groups", admin_groups_path

%br
%h2 Group Payments
- remote_form_for :reader_group_payment, ReaderGroupPayment.new, :url => admin_reader_group_payments_path do |f|
  %table#reader_group_payments.fieldset{:cellpadding=>0, :cellspacing=>0, :border=>0}
    %thead
      %th Amount paid
      %th Group
      %th Date paid on
    = render @reader.reader_group_payments
  = "$#{f.text_field :amount}"
  = date_select :reader_group_payment, :payment_date
  = f.select :group_id, @reader.groups.map { |group| [group.name, group.id] }
  = f.hidden_field :reader_id, :value => @reader.id
  = f.submit "Add Payment"
      

:javascript
  $('optional_fields').hide();
  