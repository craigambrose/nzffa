%script{:type => 'text/javascript', :src => 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'}
%div{:style => 'float: right'}
  %h3{:class => 'center'} Free Adverts!
  =link_to 'Post new advert', [:new, :advert]
  =link_to 'Edit your company listing', edit_company_listing_adverts_path
%h1 Marketplace
%h2 For farm forestry
%p
  %form#query-form{:action => index_table_adverts_path, :method => :get}
    =hidden_field_tag 'sort', 'date'
    =label_tag 'Search:'
    =text_field_tag 'query', params[:query], :size => 10

%div#table
  =render :partial => 'table'

:javascript
  $('form#query-form').submit(function(e){
    e.preventDefault();
    $('#table').text('Loading...');
    $.get('/adverts/index_table.js',
      $('form#query-form').serialize(),
      function(data){ $('#table').html(data) });
  });

  $('div#table').on('click', 'th a.sortby', function(e){
    e.preventDefault();
    $('#table').text('Loading...');
    $('input#sort').attr('value', $(this).data('column'));
    $.get('/adverts/index_table.js',
      $('form#query-form').serialize(),
      function(data){ $('#table').html(data) });

  });
